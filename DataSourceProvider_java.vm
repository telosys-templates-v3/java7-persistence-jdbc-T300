/*
 * Created on $today.date ( Time $today.time )
 * Generated by $generator.name ( version $generator.version )
 */
package ${target.javaPackageFromFolder($SRC)};

import java.io.IOException;
import java.io.InputStream;
import java.util.Properties;

import javax.sql.DataSource;

import org.apache.commons.dbcp.BasicDataSource; 

//import com.zaxxer.hikari.HikariDataSource;

/**
 * DataSource provider
 * 
 * @author Telosys Tools
 *
 */
public class DataSourceProvider {
	
	/**
	 * The properties file containing the JDBC DataSource configuration
	 */
	private final static String JDBC_PROPERTIES_FILE_NAME = "/jdbc.properties" ;
	
	/**
	 * The unique DataSource instance (singleton)
	 */
	private final static DataSource datasource = createDataSource() ;
	
	public static DataSource getDataSource() {
		return datasource;
	}

	private static DataSource createDataSource() {
		Properties env = loadPropertiesFromClassPath(JDBC_PROPERTIES_FILE_NAME);

		BasicDataSource datasource = new BasicDataSource();
		datasource.setDriverClassName(env.getProperty("jdbc.driverClassName"));
		datasource.setUrl(env.getProperty("jdbc.url"));
		datasource.setUsername(env.getProperty("jdbc.username"));
		datasource.setPassword(env.getProperty("jdbc.password"));
		return datasource ;
	}

//	private static DataSource createDataSourceHikary() {
//		HikariDataSource datasource = new HikariDataSource();
//		// TODO : configuration
//		return datasource ;
//	}

	private static Properties loadPropertiesFromClassPath(String fileName) {
		Properties properties = new Properties();
		InputStream is = DataSourceProvider.class.getResourceAsStream(fileName) ;
		if ( is != null ) {
			try {
				properties.load( DataSourceProvider.class.getResourceAsStream(fileName) );
			} catch (IOException e) {
				throw new RuntimeException("Cannot load '" + fileName + "'", e);
			}
			return properties ;
		}
		else {
			throw new RuntimeException("Cannot found '" + fileName + "' (InputStream is null)" );
		}
	}
}
